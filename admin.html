<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Admin Panel - ETHIO GAMER TOP-UP</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 30px;
      text-align: center;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    th, td {
      border: 1px solid #ddd;
      padding: 10px;
    }
    th {
      background-color: #0077cc;
      color: white;
    }
    input[type="email"], input[type="password"] {
      padding: 10px;
      margin: 5px;
      width: 250px;
    }
    button {
      padding: 10px 20px;
      margin: 5px;
      cursor: pointer;
    }
    #adminPanel {
      display: none;
    }
  </style>
</head>
<body>

  <h1>ETHIO GAMER ADMIN PANEL</h1>

  <!-- Login Section -->
  <div id="loginSection">
    <h3>Login as Admin</h3>
    <input type="email" id="email" placeholder="Email"><br>
    <input type="password" id="password" placeholder="Password"><br>
    <button onclick="login()">Login</button>
  </div>

  <!-- Admin Panel -->
  <div id="adminPanel">
    <button onclick="logout()">Logout</button>
    <h2>Transaction Management</h2>
    <table>
      <thead>
        <tr>
          <th>Bank</th>
          <th>Transaction</th>
          <th>Date</th>
          <th>Order Done ✅</th>
          <th>Receipt Verified 🧾</th>
        </tr>
      </thead>
      <tbody id="transactionList"></tbody>
    </table>
    <button onclick="saveUpdates()">✅ Save All Changes</button>
  </div>

  <!-- Firebase Scripts -->
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js"></script>

  <script>
    // Firebase Config
    const firebaseConfig = {
      apiKey: "AIzaSyBamCALWsdrWviiEkA26cP6dCJZqZ5NScY",
      authDomain: "ethio-a1e95.firebaseapp.com",
      databaseURL: "https://ethio-a1e95-default-rtdb.firebaseio.com",
      projectId: "ethio-a1e95",
      storageBucket: "ethio-a1e95.appspot.com",
      messagingSenderId: "697514706181",
      appId: "1:697514706181:web:03147af1833cc25719636c",
      measurementId: "G-FDTWBNFP7F"
    };

    // Initialize Firebase
    const app = firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.database();

    // Login Function
    function login() {
      const email = document.getElementById("email").value;
      const password = document.getElementById("password").value;
      auth.signInWithEmailAndPassword(email, password)
        .then(() => alert("✅ Logged in successfully!"))
        .catch(err => alert("❌ " + err.message));
    }

    // Logout Function
    function logout() {
      auth.signOut().then(() => {
        alert("🚪 Logged out.");
        document.getElementById("adminPanel").style.display = "none";
        document.getElementById("loginSection").style.display = "block";
      });
    }

    // Auth State Check
    auth.onAuthStateChanged(user => {
      if (user) {
        document.getElementById("loginSection").style.display = "none";
        document.getElementById("adminPanel").style.display = "block";
        loadTransactions();
      } else {
        document.getElementById("loginSection").style.display = "block";
        document.getElementById("adminPanel").style.display = "none";
      }
    });

    // Load Transactions from Firebase
    function loadTransactions() {
      const list = document.getElementById("transactionList");
      list.innerHTML = "";

      db.ref("transactions").once("value", snapshot => {
        snapshot.forEach(child => {
          const data = child.val();
          const row = document.createElement("tr");

          row.innerHTML = `
            <td>${data.bank}</td>
            <td>${data.txn}</td>
            <td>${data.date}</td>
            <td><input type="checkbox" ${data.orderDone ? "checked" : ""} data-key="${child.key}" data-field="orderDone"></td>
            <td><input type="checkbox" ${data.receiptVerified ? "checked" : ""} data-key="${child.key}" data-field="receiptVerified"></td>
          `;
          list.appendChild(row);
        });
      });
    }

    // Save Checkbox Status Updates
    function saveUpdates() {
      const checkboxes = document.querySelectorAll("input[type='checkbox']");
      checkboxes.forEach(cb => {
        const key = cb.getAttribute("data-key");
        const field = cb.getAttribute("data-field");
        const value = cb.checked;
        db.ref("transactions/" + key + "/" + field).set(value);
      });
      alert("✅ All updates saved!");
    }
  </script>

</body>
</html>
